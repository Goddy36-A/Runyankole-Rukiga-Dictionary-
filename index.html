<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Runyankole-Rukiga Dictionary</title>

  <!-- PapaParse for CSV fallback parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: left; }
    th { background: #f4f4f4; }
    .error { color: red; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Runyankole‑Rukiga Dictionary</h1>
  <p id="status">Loading dictionary...</p>

  <!-- Container the script will populate -->
  <div id="content"></div>

  <script>
    // CONFIG: Update if your branch/path is different.
    const owner = "Goddy36-A";
    const repo = "Runyankole-Rukiga-Dictionary-";
    const branch = "main"; // change to 'master' or the branch you use if needed
    const jsonPath = "runyakitara.json"; // file path in repo
    const csvPath = "afterexcel.csv";    // file path in repo

    // Raw GitHub URLs
    const rawBase = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/`;
    const jsonUrl = rawBase + jsonPath;
    const csvUrl = rawBase + csvPath;

    const statusEl = document.getElementById("status");
    const contentEl = document.getElementById("content");

    function renderTable(dataArray) {
      if (!Array.isArray(dataArray) || dataArray.length === 0) {
        contentEl.innerHTML = "<p>No dictionary entries found.</p>";
        return;
      }

      // Use keys from first item for headers
      const keys = Object.keys(dataArray[0]);
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      keys.forEach(k => {
        const th = document.createElement("th");
        th.textContent = k;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      dataArray.forEach(item => {
        const tr = document.createElement("tr");
        keys.forEach(k => {
          const td = document.createElement("td");
          td.textContent = item[k] ?? "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      contentEl.innerHTML = "";
      contentEl.appendChild(table);
    }

    async function tryLoadJsonThenCsv() {
      try {
        statusEl.textContent = "Trying to load JSON from GitHub...";
        const resp = await fetch(jsonUrl);
        if (resp.ok) {
          const json = await resp.json();
          statusEl.textContent = `Loaded JSON (${jsonPath}).`;
          renderTable(Array.isArray(json) ? json : (json.items || json.entries || [json]));
          return;
        } else {
          console.warn("JSON not found or not OK:", resp.status);
        }
      } catch (err) {
        console.warn("JSON fetch error:", err);
      }

      // JSON failed — try CSV fallback
      try {
        statusEl.textContent = "JSON not available — trying CSV fallback...";
        const resp2 = await fetch(csvUrl);
        if (!resp2.ok) throw new Error("CSV fetch returned " + resp2.status);
        const text = await resp2.text();

        // Ensure PapaParse is loaded
        if (window.Papa && typeof window.Papa.parse === "function") {
          const parsed = window.Papa.parse(text, { header: true, skipEmptyLines: true });
          if (parsed && parsed.data) {
            statusEl.textContent = `Loaded CSV (${csvPath}).`;
            renderTable(parsed.data);
            return;
          } else {
            throw new Error("CSV parse returned no data");
          }
        } else {
          // If PapaParse not available, do a simple CSV parse (header-only)
          const rows = text.trim().split(/\r?\n/).map(r => r.split(","));
          const headers = rows.shift().map(h => h.trim());
          const data = rows.map(r => {
            const obj = {};
            headers.forEach((h, i) => obj[h] = (r[i] || "").trim());
            return obj;
          });
          statusEl.textContent = `Loaded CSV (${csvPath}) via simple parser.`;
          renderTable(data);
          return;
        }
      } catch (err) {
        console.error("CSV fallback error:", err);
        statusEl.textContent = "Failed to load dictionary from repository.";
        contentEl.innerHTML = `<p class="error">Could not load ${jsonPath} or ${csvPath} from the repository raw URLs. Check that the files exist at the configured branch/path and that the repository and branch names above are correct.</p>`;
      }
    }

    tryLoadJsonThenCsv();
  </script>
</body>
</html>
